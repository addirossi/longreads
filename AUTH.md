# Аутентификация и авторизация в DRF

## Что такое аутентификация?

**Аутентификация** - это процесс проверки подлинности субъекта, который пытается получить доступ к системе или ресурсу. В целом, аутентификация обеспечивает ответ на вопрос: "Кто вы?"

В контексте веб-разработки и информационной безопасности, аутентификация используется для проверки подлинности пользователей, устройств или сервисов перед предоставлением доступа к защищенным ресурсам или данным. Это основной механизм защиты информации от несанкционированного доступа.

Аутентификация может проходить по разным методам и факторам:

- Что вы знаете (что-то, что вы знаете): Например, пароль, пин-код или ответ на секретный вопрос.

- Что у вас есть (что-то, что вы имеете): Например, физический ключ, смарт-карта, USB-ключ.

- Кто вы (что-то, что вы являетесь): Например, отпечаток пальца, голос или сканирование сетчатки.

- Где вы (где вы находитесь): Например, местоположение устройства, IP-адрес.

- Что вы делаете (что вы делаете): Например, способ, которым вы взаимодействуете с системой, например, ввод сенсорного жеста на экране смартфона.

Хорошая аутентификация обеспечивает надежность и безопасность системы, предотвращая несанкционированный доступ. Однако важно также учитывать баланс между безопасностью и удобством для пользователей, чтобы избежать чрезмерных требований к аутентификации, которые могут привести к ухудшению пользовательского опыта.

## Типы аутентификации в DRF

- **Basic Authentication (Базовая аутентификация)**
В этом методе пользователь отправляет свои учетные данные (имя пользователя и пароль) через HTTP заголовок. DRF предоставляет поддержку базовой аутентификации с помощью класса `rest_framework.authentication.BasicAuthentication`.

- **Session Authentication (Сессионная аутентификация)**
этот метод аутентификации аналогичен стандартной аутентификации Django, которая использует механизм сессий. После успешной аутентификации пользователя Django создает уникальную сессию и сохраняет ее в базе данных или другом месте. Последующие запросы включают идентификатор сессии, который сервер использует для проверки аутентификации. Для использования сессионной аутентификации в DRF, добавьте `rest_framework.authentication.SessionAuthentication` в список `DEFAULT_AUTHENTICATION_CLASSES`.

- **Token Authentication (Токен аутентификация)**
Этот метод аутентификации предоставляет удобный способ для аутентификации пользователей при доступе к вашему API. Каждый пользователь обладает уникальным токеном, который они должны предоставить при каждом запросе к API. Токены хранятся в базе данных и выделяются каждому пользователю при его создании. Для использования токен аутентификации в DRF, вы должны добавить `rest_framework.authentication.TokenAuthentication` в список `DEFAULT_AUTHENTICATION_CLASSES` в настройках Django.

- **JWT Authentication (JWT аутентификация)**
JWT (JSON Web Token) - это стандартный метод представления утверждений между двумя сторонами в виде JSON-объекта. Он состоит из трех частей: заголовка (Header), полезной нагрузки (Payload) и подписи (Signature). JWT используется для безопасной передачи информации между клиентом и сервером в виде компактного и самодостаточного токена.
JWT аутентификация в Django Rest Framework предоставляет безопасный способ аутентификации пользователей при доступе к API. 

- **Custom Authentication (Пользовательская аутентификация)**
Вы можете создать свой собственный класс аутентификации, наследуясь от `rest_framework.authentication.BaseAuthentication` и реализовав метод `authenticate()`. Это позволяет вам определить собственную логику аутентификации.

Давайте рассмотрим некоторые из типов аутентификации более подробно:

## Token Authentication

Токен аутентификация (Token Authentication) - это метод аутентификации, который использует токены для подтверждения подлинности пользователя. В случае веб-приложений API, каждый пользователь обычно получает уникальный токен доступа после успешной аутентификации. Этот токен передается с каждым запросом на сервер и используется для идентификации пользователя и предоставления ему доступа к защищенным ресурсам или операциям.

Вот пример работы токен аутентификации в Django Rest Framework (DRF):

**1. Настройка токен аутентификации:**

Откройте файл настроек settings.py вашего проекта и добавьте `rest_framework` и `rest_framework.authtoken` в список `INSTALLED_APPS`. Также добавьте `rest_framework.authentication.TokenAuthentication` в список `DEFAULT_AUTHENTICATION_CLASSES`:

```python
INSTALLED_APPS = [
    ...
    'rest_framework',
    'rest_framework.authtoken'
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],
}
```
Выполните миграций
```bash
python manage.py migrate
```

**2. Создание пользователя:**

Создайте пользователя в Django. Вы можете сделать это через команду `createsuperuser` в терминале Django:
```bash
python manage.py createsuperuser
```

**3. Предоставление токена доступа:**

После того, как у вас есть пользователь, вы можете получить токен доступа для этого пользователя. Для этого, вам нужно отправить POST-запрос на `api-token-auth` с именем пользователя и паролем. В ответе вы получите токен.

```json
{"token":"your_token_value"}
```
**4.Использование токена в запросах:**

Теперь, чтобы отправить запрос на защищенный ресурс, вам нужно включить токен в заголовке запроса. Добавьте заголовок `Authorization` с значением `Token your_token_value`, где `your_token_value` - это токен, который вы получили на предыдущем шаге.

DRF автоматически проверит токен в заголовке запроса и, если он действителен, предоставит доступ к запрашиваемому ресурсу.

## JWT Authentication

Это ещё один подвид аутентификации по токену, в котором используется так называемый JWT (JSON Web Token).

**JWT (JSON Web Token)** - это открытый стандарт (RFC 7519), который определяет компактный и автономный способ передачи информации между сторонами как JSON-объект. JWT может быть использован для аутентификации и обмена информацией между сторонами в безопасном формате. JWT состоит из трех частей: заголовка, полезной нагрузки и подписи.

Django Rest Framework (DRF) предоставляет интеграцию с JWT через сторонние пакеты, такие как `djangorestframework-simplejwt`. Вот как настроить JWT аутентификацию в DRF:

**1. Установка пакета:**

Установите djangorestframework-simplejwt с помощью pip:
```bash
pip install djangorestframework-simplejwt
```
**2. Настройка JWT в DRF:**

Добавьте `rest_framework_simplejwt.authentication.JWTAuthentication` в список `DEFAULT_AUTHENTICATION_CLASSES` в настройках Django:

```python
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
}
```

**3. Настройка URL-адресов:**

Добавьте URL-адреса для получения и обновления токенов в файл `urls.py` вашего приложения:
```python
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView

urlpatterns = [
    ...
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
]
```

**4. Получение JWT токена:**

Пользователь может получить JWT токен после аутентификации, отправив POST-запрос на URL `api/token/` с учетными данными (например, имя пользователя и пароль).

Пример ответа:
```json
{
    "access": "your_access_token",
    "refresh": "your_refresh_token"
}
```

**5. Использование JWT токена:**

После получения токена, пользователь может использовать его для доступа к защищенным ресурсам, включая его в заголовок запроса `Authorization` в формате `Bearer your_access_token`. 

DRF автоматически проверит токен и, если он действителен, предоставит доступ к защищенному ресурсу.

**6. Обновление токена:**

JWT токен имеет ограниченное время жизни. Чтобы обновить токен после его истечения срока действия, пользователь может отправить POST-запрос на URL `api/token/refresh/` с обновлением токена (refresh token).

Пример ответа:
```json
{
    "access": "new_access_token"
}
```

